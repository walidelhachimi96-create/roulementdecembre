<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau Roulement - DÃ©cembre 2025</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            body { background: white; }
            button { display: none !important; }
            .sticky { position: static !important; }
            table { font-size: 8px; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/javascript">
        const { useState } = React;
        const e = React.createElement;

        // Lucide icons as inline SVG
        const Icons = {
            Download: () => e('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                e('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
                e('polyline', { points: '7 10 12 15 17 10' }),
                e('line', { x1: 12, y1: 15, x2: 12, y2: 3 })
            ),
            FileSpreadsheet: () => e('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                e('path', { d: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z' }),
                e('polyline', { points: '14 2 14 8 20 8' }),
                e('line', { x1: 16, y1: 13, x2: 8, y2: 13 }),
                e('line', { x1: 16, y1: 17, x2: 8, y2: 17 }),
                e('line', { x1: 10, y1: 9, x2: 8, y2: 9 })
            ),
            Edit2: () => e('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                e('path', { d: 'M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z' })
            ),
            Save: () => e('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                e('path', { d: 'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z' }),
                e('polyline', { points: '17 21 17 13 7 13 7 21' }),
                e('polyline', { points: '7 3 7 8 15 8' })
            ),
            X: () => e('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                e('line', { x1: 18, y1: 6, x2: 6, y2: 18 }),
                e('line', { x1: 6, y1: 6, x2: 18, y2: 18 })
            ),
            AlertCircle: () => e('svg', { width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
                e('circle', { cx: 12, cy: 12, r: 10 }),
                e('line', { x1: 12, y1: 8, x2: 12, y2: 12 }),
                e('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 })
            )
        };

        function RoulementDecembre() {
            const [numWorkers, setNumWorkers] = useState(8);
            const [selectedMonth, setSelectedMonth] = useState(12); // December
            const [selectedYear, setSelectedYear] = useState(2025);
            
            const workers = Array.from({ length: numWorkers }, (_, i) => `Ouvrier ${i + 1}`);
            
            const months = [
                { value: 1, name: 'Janvier', days: 31 },
                { value: 2, name: 'FÃ©vrier', days: selectedYear % 4 === 0 ? 29 : 28 },
                { value: 3, name: 'Mars', days: 31 },
                { value: 4, name: 'Avril', days: 30 },
                { value: 5, name: 'Mai', days: 31 },
                { value: 6, name: 'Juin', days: 30 },
                { value: 7, name: 'Juillet', days: 31 },
                { value: 8, name: 'AoÃ»t', days: 31 },
                { value: 9, name: 'Septembre', days: 30 },
                { value: 10, name: 'Octobre', days: 31 },
                { value: 11, name: 'Novembre', days: 30 },
                { value: 12, name: 'DÃ©cembre', days: 31 }
            ];
            
            const currentMonth = months.find(m => m.value === selectedMonth);
            const daysInMonth = currentMonth.days;

            const generateSchedule = (useSeed = true) => {
                const schedule = [];
                const daysInMonth = 31;
                
                // Use fixed seed for initial load, random for shuffle
                let seed = useSeed ? 12345 : Date.now() + Math.random() * 10000;
                const seededRandom = () => {
                    if (!useSeed) return Math.random();
                    seed = (seed * 9301 + 49297) % 233280;
                    return seed / 233280;
                };

                // Random initial state for each worker
                const workerCycles = workers.map((_, idx) => {
                    const startResting = useSeed ? (idx >= 5) : (seededRandom() > 0.7);
                    const startWorkDays = startResting ? 0 : Math.floor(seededRandom() * 5);
                    
                    return {
                        workDays: startWorkDays,
                        restDays: 0,
                        isResting: startResting,
                        restType: idx % 2 === 0 ? 1 : 2,
                        totalDaysWorked: 0,
                        totalRestDays: 0,
                        consecutiveMorningDays: 0, // Track consecutive DAYS working morning (not total mornings)
                        assignments: { 'Gare-M': 0, 'Port-M': 0, 'Neuf-S': 0, 'Gare-S': 0, 'Port-S': 0 },
                        lastShift: null
                    };
                });

                for (let day = 1; day <= daysInMonth; day++) {
                    const daySchedule = {
                        date: day,
                        workers: Array(7).fill(null)
                    };

                    const availableWorkers = [];
                    const restingWorkers = [];

                    for (let w = 0; w < 8; w++) {
                        if (workerCycles[w].isResting) {
                            workerCycles[w].restDays++;
                            workerCycles[w].totalRestDays++;
                            restingWorkers.push(w);
                            daySchedule.workers[w] = `Repos (${workerCycles[w].restType}j)`;

                            if (workerCycles[w].restDays >= workerCycles[w].restType) {
                                workerCycles[w].isResting = false;
                                workerCycles[w].restDays = 0;
                                workerCycles[w].workDays = 0;
                                workerCycles[w].consecutiveMorningDays = 0;
                                workerCycles[w].restType = workerCycles[w].restType === 1 ? 2 : 1;
                            }
                        } else {
                            // CRITICAL: Check BEFORE incrementing if already at 5 days
                            if (workerCycles[w].workDays >= 5) {
                                // MUST rest now - already worked 5 days
                                workerCycles[w].isResting = true;
                                workerCycles[w].restDays = 1;
                                workerCycles[w].totalRestDays++;
                                workerCycles[w].workDays = 0;
                                workerCycles[w].consecutiveMorningDays = 0;
                                restingWorkers.push(w);
                                daySchedule.workers[w] = `Repos (${workerCycles[w].restType}j)`;
                                
                                if (workerCycles[w].restDays >= workerCycles[w].restType) {
                                    workerCycles[w].isResting = false;
                                    workerCycles[w].restDays = 0;
                                    workerCycles[w].restType = workerCycles[w].restType === 1 ? 2 : 1;
                                }
                            } 
                            // Check if 5 consecutive DAYS working morning
                            else if (workerCycles[w].consecutiveMorningDays >= 5) {
                                workerCycles[w].isResting = true;
                                workerCycles[w].restDays = 1;
                                workerCycles[w].totalRestDays++;
                                workerCycles[w].workDays = 0;
                                workerCycles[w].restType = 2; // Force 2 days rest
                                workerCycles[w].consecutiveMorningDays = 0;
                                restingWorkers.push(w);
                                daySchedule.workers[w] = `Repos (2j)`;
                                
                                if (workerCycles[w].restDays >= 2) {
                                    workerCycles[w].isResting = false;
                                    workerCycles[w].restDays = 0;
                                    workerCycles[w].restType = 1;
                                }
                            }
                            else {
                                // Worker can work today - increment AFTER checking
                                availableWorkers.push(w);
                                workerCycles[w].workDays++;
                            }
                        }
                    }

                    const canWorkMorning = [];
                    const cannotWorkMorning = [];

                    for (let w of availableWorkers) {
                        const isAfternoonYesterday = workerCycles[w].lastShift && workerCycles[w].lastShift.includes('S');
                        if (isAfternoonYesterday) {
                            cannotWorkMorning.push(w);
                        } else {
                            canWorkMorning.push(w);
                        }
                    }

                    const shuffledMorningWorkers = [...canWorkMorning].sort(() => seededRandom() - 0.5);
                    const shuffledAfternoonWorkers = [...cannotWorkMorning].sort(() => seededRandom() - 0.5);

                    const morningPositions = ['Gare-M', 'Port-M'];
                    const afternoonPositions = ['Neuf-S', 'Gare-S', 'Port-S'];

                    let morningIdx = 0;
                    for (let i = 0; i < morningPositions.length && morningIdx < shuffledMorningWorkers.length; i++) {
                        const workerIdx = shuffledMorningWorkers[morningIdx];
                        const pos = morningPositions[i];
                        daySchedule.workers[workerIdx] = pos;
                        workerCycles[workerIdx].assignments[pos]++;
                        workerCycles[workerIdx].totalDaysWorked++;
                        workerCycles[workerIdx].lastShift = pos;
                        // Increment consecutive morning DAYS (worked morning today)
                        workerCycles[workerIdx].consecutiveMorningDays++;
                        morningIdx++;
                    }

                    const remainingForAfternoon = [
                        ...shuffledMorningWorkers.slice(morningIdx),
                        ...shuffledAfternoonWorkers
                    ].sort(() => seededRandom() - 0.5);

                    for (let i = 0; i < afternoonPositions.length && i < remainingForAfternoon.length; i++) {
                        const workerIdx = remainingForAfternoon[i];
                        const pos = afternoonPositions[i];
                        daySchedule.workers[workerIdx] = pos;
                        workerCycles[workerIdx].assignments[pos]++;
                        workerCycles[workerIdx].totalDaysWorked++;
                        workerCycles[workerIdx].lastShift = pos;
                        // Reset consecutive morning days if working afternoon only
                        workerCycles[workerIdx].consecutiveMorningDays = 0;
                    }

                    // CRITICAL: Verify ALL 5 positions are filled
                    const allPositions = ['Gare-M', 'Port-M', 'Neuf-S', 'Gare-S', 'Port-S'];
                    const assignedPositions = [];
                    
                    // Check what positions are currently assigned
                    for (let w = 0; w < 7; w++) {
                        const assignment = daySchedule.workers[w];
                        if (assignment) {
                            const cleanAssignment = assignment.replace('*', '').replace('âš¡', '');
                            if (allPositions.includes(cleanAssignment)) {
                                assignedPositions.push(cleanAssignment);
                            }
                        }
                    }
                    
                    // Find missing positions
                    const missingPositions = allPositions.filter(pos => !assignedPositions.includes(pos));
                    
                    if (missingPositions.length > 0) {
                        // Find workers available to fill gaps
                        const availableToFill = [];
                        
                        // Priority 1: Reserve workers
                        for (let w = 0; w < 8; w++) {
                            if (daySchedule.workers[w] === 'RÃ©serve') {
                                availableToFill.push(w);
                            }
                        }
                        
                        // Priority 2: Workers with no assignment
                        for (let w = 0; w < 7; w++) {
                            if (!daySchedule.workers[w]) {
                                availableToFill.push(w);
                            }
                        }
                        
                        // Priority 3: Short rest workers (ONLY IF ABSOLUTELY NECESSARY)
                        if (availableToFill.length < missingPositions.length) {
                            for (let w = 0; w < 7; w++) {
                                if (daySchedule.workers[w] === 'Repos (1j)') {
                                    // Check if this worker hasn't already worked 5 days
                                    if (workerCycles[w].workDays < 5) {
                                        availableToFill.push(w);
                                    }
                                }
                            }
                        }
                        
                        // Fill each missing position
                        for (let i = 0; i < missingPositions.length && i < availableToFill.length; i++) {
                            const pos = missingPositions[i];
                            const workerIdx = availableToFill[i];
                            const oldStatus = daySchedule.workers[workerIdx];
                            
                            // CRITICAL: Don't assign if worker already worked 5 days
                            if (workerCycles[workerIdx].workDays >= 5 && !oldStatus?.includes('Repos')) {
                                continue; // Skip this worker
                            }
                            
                            const isMorning = pos.includes('M');
                            const workedAfternoonYesterday = workerCycles[workerIdx].lastShift?.includes('S');
                            
                            // Assign with marker if needed
                            if (isMorning && workedAfternoonYesterday) {
                                daySchedule.workers[workerIdx] = pos + '*';
                            } else if (oldStatus?.includes('Repos')) {
                                daySchedule.workers[workerIdx] = pos + 'âš¡';
                                workerCycles[workerIdx].isResting = false;
                                workerCycles[workerIdx].restDays = 0;
                                workerCycles[workerIdx].workDays = 1; // Start counting from 1
                            } else {
                                daySchedule.workers[workerIdx] = pos;
                            }
                            
                            workerCycles[workerIdx].assignments[pos]++;
                            workerCycles[workerIdx].totalDaysWorked++;
                            workerCycles[workerIdx].lastShift = pos;
                            
                            if (isMorning) {
                                workerCycles[workerIdx].consecutiveMorningDays++;
                            } else {
                                workerCycles[workerIdx].consecutiveMorningDays = 0;
                            }
                        }
                    }

                    const remainingWorkers = availableWorkers.filter(w => !daySchedule.workers[w]);

                    for (let w of remainingWorkers) {
                        daySchedule.workers[w] = 'RÃ©serve';
                        workerCycles[w].totalDaysWorked++;
                        workerCycles[w].lastShift = 'RÃ©serve';
                        // Reset morning days counter for reserve workers
                        workerCycles[w].consecutiveMorningDays = 0;
                    }

                    schedule.push(daySchedule);
                }

                return { schedule, workerCycles };
            };

            const [{ schedule: initialSchedule }] = useState(() => generateSchedule(true, 8, 31));
            const [schedule, setSchedule] = useState(initialSchedule);
            const [editMode, setEditMode] = useState(false);
            const [selectedCell, setSelectedCell] = useState(null);
            const [showOptions, setShowOptions] = useState(false);

            const resetSchedule = () => {
                const { schedule: newSchedule } = generateSchedule(false, numWorkers, daysInMonth);
                setSchedule(newSchedule);
                setEditMode(false);
            };

            const addWorker = () => {
                if (numWorkers < 15) {
                    const newNum = numWorkers + 1;
                    setNumWorkers(newNum);
                    const { schedule: newSchedule } = generateSchedule(false, newNum, daysInMonth);
                    setSchedule(newSchedule);
                }
            };

            const removeWorker = () => {
                if (numWorkers > 5) {
                    const newNum = numWorkers - 1;
                    setNumWorkers(newNum);
                    const { schedule: newSchedule } = generateSchedule(false, newNum, daysInMonth);
                    setSchedule(newSchedule);
                }
            };
            
            const changeMonth = (month) => {
                setSelectedMonth(month);
                const newDays = months.find(m => m.value === month).days;
                const { schedule: newSchedule } = generateSchedule(false, numWorkers, newDays);
                setSchedule(newSchedule);
            };
            
            const changeYear = (year) => {
                setSelectedYear(year);
                const newDays = selectedMonth === 2 ? (year % 4 === 0 ? 29 : 28) : currentMonth.days;
                const { schedule: newSchedule } = generateSchedule(false, numWorkers, newDays);
                setSchedule(newSchedule);
            };

            const getDayName = (day) => {
                const date = new Date(selectedYear, selectedMonth - 1, day);
                const days = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];
                return days[date.getDay()];
            };

            const options = [
                'Gare-M', 'Port-M', 'Neuf-S', 'Gare-S', 'Port-S',
                'RÃ©serve', 'Repos (1j)', 'Repos (2j)', 'Malade', 'Absent'
            ];

            const handleCellClick = (dayIdx, workerIdx) => {
                if (editMode) {
                    setSelectedCell({ dayIdx, workerIdx });
                    setShowOptions(true);
                }
            };

            const handleOptionSelect = (option) => {
                if (selectedCell) {
                    const newSchedule = [...schedule];
                    const { dayIdx, workerIdx } = selectedCell;
                    const oldAssignment = newSchedule[dayIdx].workers[workerIdx];

                    if (option === 'Malade') {
                        const dayWorkers = newSchedule[dayIdx].workers;
                        let replacementIdx = -1;

                        for (let i = 0; i < dayWorkers.length; i++) {
                            if (dayWorkers[i] === 'RÃ©serve') {
                                replacementIdx = i;
                                break;
                            }
                        }

                        if (replacementIdx === -1) {
                            for (let i = 0; i < dayWorkers.length; i++) {
                                if (dayWorkers[i]?.includes('Repos')) {
                                    replacementIdx = i;
                                    break;
                                }
                            }
                        }

                        if (replacementIdx !== -1 && oldAssignment && !oldAssignment.includes('Repos')) {
                            newSchedule[dayIdx].workers[replacementIdx] = oldAssignment + 'â†”ï¸';
                            newSchedule[dayIdx].workers[workerIdx] = 'Malade';
                        } else {
                            newSchedule[dayIdx].workers[workerIdx] = 'Malade âš ï¸';
                        }
                    } else {
                        newSchedule[dayIdx].workers[workerIdx] = option;
                    }

                    setSchedule(newSchedule);
                    setShowOptions(false);
                    setSelectedCell(null);
                }
            };

            const resetSchedule = () => {
                const { schedule: newSchedule } = generateSchedule(false, numWorkers);
                setSchedule(newSchedule);
                setEditMode(false);
            };

            const printSchedule = () => {
                window.print();
            };

            const downloadExcel = () => {
                let csv = 'Ouvrier';
                for (let day = 1; day <= daysInMonth; day++) {
                    csv += `,${day} ${getDayName(day)}`;
                }
                csv += ',Repos Total\n';

                workers.forEach((worker, idx) => {
                    csv += worker;
                    schedule.forEach(day => {
                        const assignment = day.workers[idx] || '-';
                        csv += `,${assignment}`;
                    });
                    const totalRestDays = schedule.filter(day => day.workers[idx]?.includes('Repos')).length;
                    csv += `,${totalRestDays}\n`;
                });

                csv += '\n\nNotes:\n';
                csv += 'â€¢ SystÃ¨me de travail: 5 jours consÃ©cutifs puis repos\n';
                csv += 'â€¢ Ouvrier travaillÃ© soir â†’ ne travaille pas matin le jour suivant\n';

                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `Roulement_${currentMonth.name}_${selectedYear}.csv`;
                link.click();
            };

            return e('div', { className: 'p-4 bg-gray-50 min-h-screen' },
                e('div', { className: 'bg-white rounded-lg shadow-lg p-4 mb-4' },
                    e('div', { className: 'flex justify-between items-center mb-4' },
                        e('div', null,
                            e('h1', { className: 'text-2xl font-bold text-gray-800' }, `Tableau Roulement - ${currentMonth.name} ${selectedYear}`),
                            e('div', { className: 'flex gap-2 mt-2' },
                                e('select', {
                                    value: selectedMonth,
                                    onChange: (ev) => changeMonth(parseInt(ev.target.value)),
                                    className: 'border border-gray-300 rounded px-3 py-1 text-sm'
                                }, ...months.map(m => e('option', { key: m.value, value: m.value }, m.name))),
                                e('select', {
                                    value: selectedYear,
                                    onChange: (ev) => changeYear(parseInt(ev.target.value)),
                                    className: 'border border-gray-300 rounded px-3 py-1 text-sm'
                                }, 
                                    e('option', { value: 2024 }, '2024'),
                                    e('option', { value: 2025 }, '2025'),
                                    e('option', { value: 2026 }, '2026'),
                                    e('option', { value: 2027 }, '2027'),
                                    e('option', { value: 2028 }, '2028')
                                )
                            )
                        ),
                        e('div', { className: 'flex gap-2 items-center' },
                            e('div', { className: 'flex items-center gap-2 bg-gray-100 rounded-lg p-2' },
                                e('button', {
                                    onClick: removeWorker,
                                    disabled: numWorkers <= 5,
                                    className: `px-3 py-2 rounded font-bold text-lg transition ${numWorkers <= 5 ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-red-500 text-white hover:bg-red-600'}`
                                }, 'âˆ’'),
                                e('span', { className: 'font-bold text-lg px-2' }, `${numWorkers} ouvriers`),
                                e('button', {
                                    onClick: addWorker,
                                    disabled: numWorkers >= 15,
                                    className: `px-3 py-2 rounded font-bold text-lg transition ${numWorkers >= 15 ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-green-500 text-white hover:bg-green-600'}`
                                }, '+')
                            ),
                            e('button', {
                                onClick: () => setEditMode(!editMode),
                                className: `flex items-center gap-2 px-4 py-2 rounded transition ${editMode ? 'bg-red-600 text-white hover:bg-red-700' : 'bg-yellow-600 text-white hover:bg-yellow-700'}`
                            },
                                editMode ? e(Icons.X) : e(Icons.Edit2),
                                editMode ? 'Annuler' : 'Modifier'
                            ),
                            e('button', {
                                onClick: resetSchedule,
                                className: 'flex items-center gap-2 bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition'
                            },
                                e(Icons.AlertCircle),
                                'MÃ©langer Services'
                            ),
                            e('button', {
                                onClick: downloadExcel,
                                className: 'flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition'
                            },
                                e(Icons.FileSpreadsheet),
                                'Excel'
                            ),
                            e('button', {
                                onClick: printSchedule,
                                className: 'flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition'
                            },
                                e(Icons.Download),
                                'Imprimer'
                            )
                        )
                    ),
                    editMode && e('div', { className: 'bg-yellow-50 border-l-4 border-yellow-500 p-3 mb-4' },
                        e('p', { className: 'text-sm text-yellow-800 font-semibold' }, 'ğŸ”§ Mode Ã©dition activÃ©: Cliquez sur une case pour modifier')
                    ),
                    e('div', { className: 'grid grid-cols-4 gap-3 text-xs mb-4' },
                        e('div', { className: 'bg-blue-50 p-2 rounded' }, e('strong', null, 'Nombre d\'ouvriers: '), numWorkers),
                        e('div', { className: 'bg-green-50 p-2 rounded' }, e('strong', null, 'Mois: '), `${currentMonth.name} ${selectedYear}`),
                        e('div', { className: 'bg-yellow-50 p-2 rounded' }, e('strong', null, 'Jours: '), `${daysInMonth} jours`),
                        e('div', { className: 'bg-purple-50 p-2 rounded' }, e('strong', null, 'Positions: '), '5 (Gare, Neuf, Port)')
                    ),
                    e('div', { className: 'text-xs text-gray-600 flex gap-3 flex-wrap' },
                        e('span', null, e('strong', null, 'M: '), 'Matin'),
                        e('span', null, e('strong', null, 'S: '), 'Soir'),
                        e('span', { className: 'text-red-600' }, e('strong', null, 'Repos: '), 'Repos'),
                        e('span', { className: 'text-pink-600' }, e('strong', null, 'Malade: '), 'Maladie'),
                        e('span', { className: 'text-cyan-600' }, e('strong', null, 'â†”ï¸: '), 'RemplaÃ§ant'),
                        e('span', { className: 'text-orange-600' }, e('strong', null, 'RÃ©serve: '), 'RÃ©serve'),
                        e('span', { className: 'text-yellow-600' }, e('strong', null, '*: '), 'Urgence (travaillÃ© soir hier)'),
                        e('span', { className: 'text-gray-600' }, e('strong', null, 'âš ï¸: '), 'Pas de remplaÃ§ant')
                    )
                ),
                showOptions && e('div', {
                    className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
                    onClick: () => setShowOptions(false)
                },
                    e('div', {
                        className: 'bg-white rounded-lg p-6 max-w-md w-full mx-4',
                        onClick: (ev) => ev.stopPropagation()
                    },
                        e('h3', { className: 'text-lg font-bold mb-4' }, 'Choisir le statut:'),
                        e('div', { className: 'grid grid-cols-2 gap-2' },
                            ...options.map((option, idx) =>
                                e('button', {
                                    key: idx,
                                    onClick: () => handleOptionSelect(option),
                                    className: 'p-3 bg-blue-50 hover:bg-blue-100 rounded border border-blue-200 text-sm font-semibold transition'
                                }, option)
                            )
                        ),
                        e('button', {
                            onClick: () => setShowOptions(false),
                            className: 'mt-4 w-full bg-gray-200 hover:bg-gray-300 p-2 rounded font-semibold'
                        }, 'Annuler')
                    )
                ),
                e('div', { className: 'bg-white rounded-lg shadow-lg overflow-x-auto' },
                    e('table', { className: 'w-full text-xs border-collapse' },
                        e('thead', null,
                            e('tr', { className: 'bg-gray-800 text-white' },
                                e('th', { className: 'border border-gray-600 p-2 sticky left-0 bg-gray-800 z-10' }, 'Ouvrier'),
                                ...schedule.map((day) =>
                                    e('th', { key: day.date, className: 'border border-gray-600 p-2 min-w-20' },
                                        e('div', { className: 'font-bold' }, day.date),
                                        e('div', { className: 'text-xs font-normal' }, getDayName(day.date))
                                    )
                                ),
                                e('th', { className: 'border border-gray-600 p-2 bg-gray-800 sticky right-0 z-10' }, 'Repos')
                            )
                        ),
                        e('tbody', null,
                            ...workers.map((worker, idx) => {
                                const totalRestDays = schedule.filter(day => day.workers[idx]?.includes('Repos')).length;
                                return e('tr', { key: idx, className: 'hover:bg-gray-50' },
                                    e('td', { className: 'border border-gray-300 p-2 font-bold bg-gray-100 sticky left-0 z-10' }, worker),
                                    ...schedule.map((day, dayIdx) => {
                                        const assignment = day.workers[idx];
                                        const isRest = assignment?.includes('Repos');
                                        const isSick = assignment?.includes('Malade');
                                        const isAbsent = assignment === 'Absent';
                                        const isReserve = assignment === 'RÃ©serve';
                                        const isReplacement = assignment?.includes('â†”ï¸');
                                        const isEmergency = assignment?.includes('*');
                                        const isGare = assignment?.includes('Gare');
                                        const isNeuf = assignment?.includes('Neuf');
                                        const isPort = assignment?.includes('Port');

                                        return e('td', {
                                            key: day.date,
                                            onClick: () => handleCellClick(dayIdx, idx),
                                            className: `border border-gray-300 p-1 text-center font-semibold text-xs transition ${editMode ? 'cursor-pointer hover:ring-2 hover:ring-blue-400' : ''} ${
                                                isRest ? 'bg-red-100 text-red-700' :
                                                isSick ? 'bg-pink-100 text-pink-700' :
                                                isAbsent ? 'bg-gray-300 text-gray-700' :
                                                isReplacement ? 'bg-cyan-100 text-cyan-800' :
                                                isReserve ? 'bg-orange-100 text-orange-700' :
                                                isEmergency ? 'bg-yellow-100 text-yellow-800' :
                                                isGare ? 'bg-blue-100 text-blue-800' :
                                                isNeuf ? 'bg-green-100 text-green-800' :
                                                isPort ? 'bg-purple-100 text-purple-800' :
                                                'bg-gray-50'
                                            }`
                                        }, assignment || '-');
                                    }),
                                    e('td', { className: 'border border-gray-300 p-2 font-bold bg-blue-50 text-blue-900 text-center sticky right-0 z-10' }, `${totalRestDays} j`)
                                );
                            })
                        )
                    )
                ),
                e('div', { className: 'mt-4 bg-white rounded-lg shadow p-3 text-xs text-gray-600' },
                    e('strong', { className: 'text-lg' }, 'Notes:'),
                    e('ul', { className: 'ml-4 mt-2 space-y-1' },
                        e('li', null, 'â€¢ ', e('strong', { className: 'text-red-600 text-base' }, 'âš ï¸ RÃˆGLE STRICTE: '), 'AUCUN ouvrier ne peut travailler plus de 5 jours consÃ©cutifs - systÃ¨me vÃ©rifiÃ© Ã  chaque jour'),
                        e('li', null, 'â€¢ ', e('strong', null, 'SystÃ¨me de travail: '), 'Chaque ouvrier travaille ', e('strong', { className: 'text-red-600' }, 'MAXIMUM 5 jours consÃ©cutifs'), ' puis DOIT prendre repos'),
                        e('li', null, 'â€¢ ', e('strong', null, 'Repos: '), 'Alterne entre 1 jour et 2 jours (maximum 2 ouvriers en repos par jour)'),
                        e('li', null, 'â€¢ ğŸ”„ ', e('strong', null, 'MÃ©langer Services: '), 'Change TOUT alÃ©atoirement: repos, services, timing - gÃ©nÃ¨re un nouveau roulement complet'),
                        e('li', null, 'â€¢ ğŸ“… ', e('strong', null, 'Changer le mois/annÃ©e: '), 'SÃ©lectionnez le mois et l\'annÃ©e dans les menus dÃ©roulants - rÃ©gÃ©nÃ¨re automatiquement le tableau avec le bon nombre de jours'),
                        e('li', null, 'â€¢ â•â– ', e('strong', null, 'Ajouter/Supprimer ouvriers: '), 'Minimum 5 ouvriers, Maximum 15 ouvriers - rÃ©gÃ©nÃ¨re automatiquement le tableau'),
                        e('li', null, 'â€¢ ğŸŒ… ', e('strong', null, 'RÃ¨gle spÃ©ciale MATIN: '), 'Si un ouvrier travaille matin (Gare-M ou Port-M) pendant 5 JOURS consÃ©cutifs â†’ repos de 2 jours OBLIGATOIRE'),
                        e('li', null, 'â€¢ ğŸ“‹ ', e('strong', null, 'RÃ¨gle gÃ©nÃ©rale: '), 'Si un ouvrier travaille 5 jours consÃ©cutifs (n\'importe quelle position) â†’ repos normal'),
                        e('li', null, 'â€¢ ', e('strong', null, 'Modification: '), 'Cliquez sur "Modifier" puis cliquez sur une case pour changer le statut'),
                        e('li', null, 'â€¢ ğŸ©º ', e('strong', null, 'Malade: '), 'Ouvrier malade - le systÃ¨me cherche automatiquement un remplaÃ§ant'),
                        e('li', null, 'â€¢ â†”ï¸ ', e('strong', null, 'RemplaÃ§ant: '), 'Ouvrier qui remplace le malade (depuis RÃ©serve ou Repos)'),
                        e('li', null, 'â€¢ âš ï¸ ', e('strong', null, 'Pas de remplaÃ§ant: '), 'Aucun remplaÃ§ant disponible'),
                        e('li', null, 'â€¢ âŒ ', e('strong', null, 'Absent: '), 'Ouvrier absent'),
                        e('li', null, 'â€¢ âš ï¸ ', e('strong', null, '*: '), 'Urgence - Ø¹Ø§Ù…Ù„ Ø¹Ù…Ù„ Ù…Ø³Ø§Ø¡ Ø£Ù…Ø³ Ù„ÙƒÙ† Ø§Ø¶Ø·Ø± ÙŠØ¹Ù…Ù„ ØµØ¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…'),
                        e('li', null, 'â€¢ âœ… ', e('strong', null, 'Ø¶Ù…Ø§Ù† 100%: '), 'Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ­Ø§ÙˆÙ„ ØªØºØ·ÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§ØµØ¨ Ø§Ù„Ø®Ù…Ø³Ø© - Ù„ÙƒÙ† Ù„Ù† ÙŠØ³ØªØ¯Ø¹ÙŠ Ø¹Ù…Ø§Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø±Ø§Ø­Ø©'),
                        e('li', null, 'â€¢ âš ï¸ ', e('strong', null, 'Ù…Ù„Ø§Ø­Ø¸Ø©: '), 'Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¹Ù…Ø§Ù„ ÙƒØ§ÙÙŠÙŠÙ†ØŒ Ù‚Ø¯ ÙŠØ¨Ù‚Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†Ø§ØµØ¨ ÙØ§Ø±ØºØ© Ù„Ø§Ø­ØªØ±Ø§Ù… ÙØªØ±Ø§Øª Ø§Ù„Ø±Ø§Ø­Ø©'),
                        e('li', null, 'â€¢ âœ… Ouvrier travaillÃ© matin (M) â†’ ', e('strong', null, 'peut'), ' travailler soir (S) le mÃªme jour ou le jour suivant')
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(RoulementDecembre));
    </script>
</body>
</html>
