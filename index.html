<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Roulement Décembre 2025</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@media print {
 body { background: white; }
 button { display:none!important; }
 table { font-size:9px; }
}
</style>
</head>
<body class="p-4 bg-gray-100">
<div id="root"></div>

<script>
const { useState } = React;
const e = React.createElement;

function App(){
 const [workers,setWorkers]=useState(["Ouvrier 1","Ouvrier 2","Ouvrier 3","Ouvrier 4","Ouvrier 5","Ouvrier 6","Ouvrier 7","Ouvrier 8"]);
 const [schedule,setSchedule]=useState([]);
 const [edit,setEdit]=useState(false);
 const [selected,setSelected]=useState(null);
 const [showAdd,setShowAdd]=useState(false);
 const [newName,setNewName]=useState("");

 function generate(){
  const days=31;
  const sched=[];
  const cycles=workers.map(()=>({
    work:0, rest:0, resting:false, last:null
  }));
  for(let d=1; d<=days; d++){
    const row=Array(workers.length).fill("");
    const can=[];
    for(let i=0;i<workers.length;i++){
      if(cycles[i].resting){
        cycles[i].rest++;
        row[i]="Repos";
        if(cycles[i].rest>=2){
          cycles[i].rest=0;
          cycles[i].resting=false;
          cycles[i].work=0;
        }
      } else {
        if(cycles[i].work>=5){
          cycles[i].resting=true;
          cycles[i].rest=1;
          row[i]="Repos";
        } else {
          can.push(i);
        }
      }
    }
    const pos=["Gare-M","Port-M","Neuf-S","Gare-S","Port-S"];
    const shuffle=[...can].sort(()=>Math.random()-0.5);
    for(let p=0;p<pos.length && p<shuffle.length;p++){
      const w=shuffle[p];
      row[w]=pos[p];
      cycles[w].work++;
      cycles[w].last=pos[p];
    }
    for(let i=0;i<workers.length;i++){
      if(!row[i] && !cycles[i].resting){
        row[i]="Réserve";
        cycles[i].last="Réserve";
      }
    }
    sched.push(row);
  }
  setSchedule(sched);
 }

 React.useEffect(()=>generate(),[workers.length]);

 const opts=["Gare-M","Port-M","Neuf-S","Gare-S","Port-S","Réserve","Repos","Absent","Malade"];

 function setCell(d,i,val){
   const copy=schedule.map(r=>[...r]);
   copy[d][i]=val;
   setSchedule(copy);
 }

 return e("div",{className:"space-y-4"},
   e("div",{className:"flex gap-2"},
     e("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:()=>setEdit(!edit)},edit?"Stop":"Modifier"),
     e("button",{className:"px-4 py-2 bg-gray-700 text-white rounded",onClick:generate},"Regénérer"),
     e("button",{className:"px-4 py-2 bg-purple-600 text-white rounded",onClick:()=>setShowAdd(true)},"+ Ajouter Ouvrier"),
     e("button",{className:"px-4 py-2 bg-green-600 text-white rounded",onClick:()=>window.print()},"Imprimer")
   ),

   showAdd && e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",onClick:()=>setShowAdd(false)},
     e("div",{className:"bg-white p-6 rounded",onClick:(ev)=>ev.stopPropagation()},
       e("h2",{className:"font-bold mb-2"},"Nouvel ouvrier"),
       e("input",{className:"border p-2 w-full mb-2",value:newName,onChange:ev=>setNewName(ev.target.value)}),
       e("button",{className:"bg-purple-600 text-white px-4 py-2 rounded w-full",onClick:()=>{
         if(newName.trim()!=""){
           setWorkers([...workers,newName.trim()]);
           setNewName("");
           setShowAdd(false);
         }
       }},"Ajouter")
     )
   ),

   e("div",{className:"overflow-auto bg-white shadow rounded"},
     e("table",{className:"w-full text-xs"},
       e("thead",null,
         e("tr",{className:"bg-gray-800 text-white"},
           e("th",{className:"p-2"},"Ouvrier"),
           schedule.map((_,i)=>e("th",{key:i,className:"p-2"},i+1)),
           e("th",{className:"p-2"},"Total Repos")
         )
       ),
       e("tbody",null,
         workers.map((w,wi)=>
           e("tr",{key:wi,className:"border-b"},
             e("td",{className:"p-2 font-bold flex justify-between items-center bg-gray-50"},
               w,
               edit && e("button",{className:"text-red-600",onClick:()=>{
                 const copy=workers.filter((_,x)=>x!==wi);
                 setWorkers(copy);
               }},"✖")
             ),
             schedule.map((day,di)=>
               e("td",{key:di,className:"p-1 text-center"+
                 (day[wi]=="Repos"?" bg-red-100":
                 day[wi]=="Réserve"?" bg-orange-100":
                 day[wi]=="Malade"?" bg-pink-100":
                 day[wi].includes("Gare")?" bg-blue-100":
                 day[wi].includes("Port")?" bg-purple-100":
                 day[wi].includes("Neuf")?" bg-green-100":"")
               ,
                onClick:()=>edit && setSelected([di,wi])
               }, day[wi]||"-")
             ),
             e("td",{className:"p-2 text-center font-bold bg-blue-50"},
               schedule.filter(r=>r[wi]=="Repos").length+" j"
             )
           )
         )
       )
     )
   ),

   selected && edit && e("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",onClick:()=>setSelected(null)},
     e("div",{className:"bg-white p-4 rounded w-60",onClick:(ev)=>ev.stopPropagation()},
       e("h3",{className:"font-bold mb-2"},"Choisir:"),
       opts.map(op=>
         e("button",{key:op,className:"w-full p-2 border mb-1 rounded bg-gray-50",
           onClick:()=>{
             const[d,i]=selected;
             setCell(d,i,op);
             setSelected(null);
           }
         },op)
       )
     )
   )
 );
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
</script>

</body>
</html>
